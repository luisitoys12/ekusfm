<!DOCTYPE html>
<html lang="es">
<head>
    <title>Estación KUSFM</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="theme-color" content="#453D79">
    
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/5db384e8a3.js" crossorigin="anonymous"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #FFFFFF;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .img_center {
            max-width: 100%;
            display: block;
            margin: 1rem auto;
        }
        
        .infos_radio {
            background-color: #1E1E1E !important;
            color: #FFFFFF;
            border-radius: 8px;
            padding: 20px 20px 20px 100px !important; /* Más espacio para el avatar */
            position: relative;
            margin: 1rem auto;
            min-height: 80px; /* Asegurar espacio para el avatar */
        }
        
        /* Estilo específico para el avatar de Habbo */
        .habbo-avatar {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            height: 80px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center left;
        }
        
        .wrapper_radio {
            background-color: #1E1E1E;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .marquee_wrapper {
            overflow: hidden;
            padding: 8px 0;
            background-color: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        
        .marquee {
            color: #FFFFFF;
            font-size: 16px;
        }
        
        .button_controle {
            background-color: #453D79;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin: 5px;
            cursor: pointer;
        }
        
        .button_controle:hover {
            background-color: #7986CB;
        }
        
        /* Próximos locutores */
        .dj-schedule {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .dj-slot {
            background-color: #1E1E1E;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .dj-avatar {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        /* Responsive para móviles */
        @media (max-width: 600px) {
            .dj-schedule {
                grid-template-columns: 1fr;
            }
        }
        
        /* Metadatos de la canción */
        .song-info {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 15px;
            margin: 15px 0;
            align-items: center;
        }
        
        .album-art {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .song-details h5 {
            margin: 0 0 5px 0;
            font-size: 18px;
        }
        
        .song-details p {
            margin: 0;
            color: #AAA;
        }
        
        /* Stats de la radio */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .stat-box {
            background-color: rgba(0,0,0,0.2);
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #AAA;
        }

        /* NUEVO: Estilos noticias/eventos */
        .noticias-lista article, .eventos-lista article {
            background: #222;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .noticias-lista h6, .eventos-lista h6 {
            color: #ffdb58;
            margin: 0 0 6px 0;
        }
        .noticias-lista span, .eventos-lista span {
            color: #aaa;
            font-size: .92em;
        }
        /* NUEVO: Estilo DJ panel */
        #dj-panel {
            max-width: 400px;
            margin: 32px auto;
            background: #181838;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 2px 8px #000a;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://i.imgur.com/ITZcSUM.png" class="img_center" alt="Estación KUSFM Logo">
        
        <!-- DJ Info Card -->
        <div class="card-panel infos_radio" id="infos_radio">
            <div class="habbo-avatar" id="habbo-avatar"></div>
            <h5 id="locutor">Cargando...</h5>
            <p>Programa: <span id="locutor_programa">Cargando...</span></p>
            <p><i class="fas fa-headphones"></i> <span id="num_ouvintes">0</span> oyentes</p>
        </div>
        
        <!-- Próximos Locutores -->
        <h5>Próximos Locutores</h5>
        <div class="dj-schedule">
            <div class="dj-slot">
                <div class="dj-avatar" id="dj1-avatar"></div>
                <h6 id="dj1-name">DJ 1</h6>
                <p id="dj1-time">18:00 - 20:00</p>
            </div>
            <div class="dj-slot">
                <div class="dj-avatar" id="dj2-avatar"></div>
                <h6 id="dj2-name">DJ 2</h6>
                <p id="dj2-time">20:00 - 22:00</p>
            </div>
            <div class="dj-slot">
                <div class="dj-avatar" id="dj3-avatar"></div>
                <h6 id="dj3-name">DJ 3</h6>
                <p id="dj3-time">22:00 - 00:00</p>
            </div>
        </div>
        
        <!-- Main Radio Player -->
        <div class="wrapper_radio z-depth-3">
            <!-- Información de la canción -->
            <div class="song-info">
                <img id="album-art" src="https://i.imgur.com/ITZcSUM.png" class="album-art" alt="Album Art">
                <div class="song-details">
                    <h5 id="song-title">Cargando...</h5>
                    <p id="song-artist">Estación KUSFM</p>
                </div>
            </div>
            
            <div class="marquee_wrapper">
                <marquee class="marquee" scrolldelay="200" id="marquee_radio">
                    <span>Estación KUSFM - Cargando...</span>
                </marquee>
            </div>
            
            <div class="center-align" style="margin: 15px 0;">
                <button class="button_controle waves-effect" id="btn_control" onclick="togglePlay()">
                    <i id="icon_control" class="fas fa-play"></i>
                </button>
                <button class="button_controle waves-effect" onclick="toggleMute()">
                    <i id="icon_mute" class="fas fa-volume-up"></i>
                </button>
                <button class="button_controle waves-effect" onclick="refreshPlayer()">
                    <i class="fas fa-sync"></i>
                </button>
            </div>
            
            <!-- Volume Slider -->
            <div style="display: flex; align-items: center; margin: 15px 0;">
                <i class="fas fa-volume-down" style="margin-right: 10px;"></i>
                <input type="range" min="0" max="100" value="80" id="volume-slider" style="flex-grow: 1;">
                <i class="fas fa-volume-up" style="margin-left: 10px;"></i>
            </div>
            
            <!-- Estadísticas de la radio -->
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="stat-listeners">0</div>
                    <div class="stat-label">Oyentes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-peak">0</div>
                    <div class="stat-label">Pico hoy</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-songs">0</div>
                    <div class="stat-label">Canciones</div>
                </div>
            </div>
            
            <!-- Audio element -->
            <audio id="player_audio" preload="auto"></audio>
        </div>
        
        <!-- Historial de canciones -->
        <h5 style="margin-top: 20px;">Canciones recientes</h5>
        <ul class="collection" id="history-container" style="background-color: #1E1E1E; border: none;">
            <li class="collection-item" style="background-color: #1E1E1E; color: white;">
                Cargando historial...
            </li>
        </ul>

        <!-- ================= NUEVO: PANEL DJ LOGIN/REGISTRO ================== -->
        <div id="dj-panel">
            <div id="login-form">
                <h5>Acceso DJs</h5>
                <input type="text" id="login-username" placeholder="Usuario DJ" class="browser-default" style="margin-bottom:8px;">
                <input type="password" id="login-password" placeholder="Contraseña" class="browser-default" style="margin-bottom:8px;">
                <button class="btn purple darken-3" onclick="loginDJ()">Ingresar</button>
                <p style="margin-top:10px;">¿No tienes cuenta? <a href="#" onclick="showRegister();return false;">Regístrate</a></p>
            </div>
            <div id="register-form" style="display:none;">
                <h5>Registro DJ</h5>
                <input type="text" id="register-username" placeholder="Usuario DJ" class="browser-default" style="margin-bottom:8px;">
                <input type="password" id="register-password" placeholder="Contraseña" class="browser-default" style="margin-bottom:8px;">
                <button class="btn purple darken-3" onclick="registerDJ()">Registrar</button>
                <p style="margin-top:10px;">¿Ya tienes cuenta? <a href="#" onclick="showLogin();return false;">Ingresa</a></p>
            </div>
            <div id="dj-panel-info" style="display:none;">
                <h5>Bienvenido DJ <span id="dj-name"></span></h5>
                <button class="btn red" onclick="logoutDJ()">Salir</button>
                <p>Hora de México: <span id="hora-mx"></span></p>
            </div>
        </div>
        <!-- ================= FIN PANEL DJ LOGIN/REGISTRO ================== -->

        <!-- ================= NUEVO: WIDGET HORA CDMX ================== -->
        <div style="margin: 30px 0;">
          <div style="text-align:center;padding:1em 0;">
            <h3>
              <a style="text-decoration:none;" href="https://www.zeitverschiebung.net/es/city/3530597" target="_blank">
                <span style="color:gray;">Hora actual en</span><br />Mexico City, México
              </a>
            </h3>
            <iframe src="https://www.zeitverschiebung.net/clock-widget-iframe-v2?language=es&size=medium&timezone=America%2FMexico_City&show=hour_minute" width="100%" height="115" frameborder="0" seamless></iframe>
          </div>
        </div>
        <!-- ================= FIN WIDGET HORA CDMX ================== -->

        <!-- ================= NUEVO: NOTICIAS Y EVENTOS ================== -->
        <div id="noticias" style="margin:32px 0;">
          <h5>Noticias</h5>
          <div class="noticias-lista"></div>
        </div>
        <div id="eventos" style="margin:32px 0;">
          <h5>Eventos</h5>
          <div class="eventos-lista"></div>
        </div>
        <!-- ================= FIN NOTICIAS Y EVENTOS ================== -->
    </div>
    <!-- ================= NUEVO: DISCLAIMER Y BADGE FANSITE ================== -->
    <footer style="margin-top:40px; padding:16px 0; background:#1E1E1E; color:#fff; text-align:center;">
      <img src="https://habsite.es/wp-content/uploads/2025/03/fansite_badge.gif" style="height:40px;vertical-align:middle;margin-right:10px;">
      <span>
        Hecho con ♥ por @estacionkusfm<br>
        Se respeta la manera Habbo. Todos los derechos reservados.<br>
        estacionkusfm no está afiliada a, respaldada, promocionada o aprobada específicamente por Sulake Corporation Oy o sus Afiliados.<br>
        Fansite Badge<br>
        De acuerdo a la Política de Webs fans de Habbo, esta radio puede utilizar las marcas comerciales y otras propiedades intelectuales de Habbo.
      </span>
    </footer>
    <!-- ================= FIN DISCLAIMER Y BADGE FANSITE ================== -->
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
    <script>
        // Configuración
        const STATION_NAME = "estacionkusfm";
        const API_URL = "https://radio.trabullnetwork.pro/api/nowplaying/" + STATION_NAME;
        const STREAM_URL = "https://radio.trabullnetwork.pro/listen/" + STATION_NAME + "/radio.mp3";
        
        // Elementos DOM
        const playerAudio = document.getElementById('player_audio');
        const playButton = document.getElementById('btn_control');
        const playIcon = document.getElementById('icon_control');
        const muteIcon = document.getElementById('icon_mute');
        const volumeSlider = document.getElementById('volume-slider');
        const marqueeRadio = document.getElementById('marquee_radio');
        const songTitle = document.getElementById('song-title');
        const songArtist = document.getElementById('song-artist');
        const albumArt = document.getElementById('album-art');
        const locutor = document.getElementById('locutor');
        const locutorPrograma = document.getElementById('locutor_programa');
        const numOuvintes = document.getElementById('num_ouvintes');
        const habboAvatar = document.getElementById('habbo-avatar');
        const historyContainer = document.getElementById('history-container');
        
        // Stats
        const statListeners = document.getElementById('stat-listeners');
        const statPeak = document.getElementById('stat-peak');
        const statSongs = document.getElementById('stat-songs');
        
        // Ejemplo de datos de DJs (reemplazar con datos reales cuando estén disponibles)
        const djData = [
            { name: "DJHabbo1", timeStart: "18:00", timeEnd: "20:00" },
            { name: "DJHabbo2", timeStart: "20:00", timeEnd: "22:00" },
            { name: "DJHabbo3", timeStart: "22:00", timeEnd: "00:00" }
        ];
        
        // Configuración inicial
        playerAudio.src = STREAM_URL;
        playerAudio.volume = volumeSlider.value / 100;
        setupDJs();
        
        // Reproducir/Pausar
        function togglePlay() {
            if (playerAudio.paused) {
                playerAudio.play()
                .then(() => {
                    playIcon.classList.remove('fa-play');
                    playIcon.classList.add('fa-pause');
                })
                .catch(e => {
                    console.error('Error reproduciendo audio:', e);
                    alert('Error al reproducir. Verifica tu conexión a internet.');
                });
            } else {
                playerAudio.pause();
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
            }
        }
        
        // Silenciar/Desilenciar
        function toggleMute() {
            playerAudio.muted = !playerAudio.muted;
            muteIcon.className = playerAudio.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
        }
        
        // Control de volumen
        volumeSlider.addEventListener('input', function() {
            playerAudio.volume = this.value / 100;
        });
        
        // Configurar avatares de DJs
        function setupDJs() {
            for (let i = 0; i < 3; i++) {
                const dj = djData[i];
                document.getElementById(`dj${i+1}-name`).textContent = dj.name;
                document.getElementById(`dj${i+1}-time`).textContent = `${dj.timeStart} - ${dj.timeEnd}`;
                document.getElementById(`dj${i+1}-avatar`).style.backgroundImage = 
                    `url('https://www.habbo.es/habbo-imaging/avatarimage?img_format=png&user=${dj.name}&direction=2&head_direction=3&size=m&gesture=sml')`;
            }
        }
        
        // Configurar avatar de Habbo
        function setHabboAvatar(username = "estacionkusfm") {
            const avatarUrl = `https://www.habbo.es/habbo-imaging/avatarimage?img_format=png&user=${username}&direction=2&head_direction=3&size=l&gesture=sml&action=std`;
            habboAvatar.style.backgroundImage = `url('${avatarUrl}')`;
        }
        
        // Refrescar reproductor
        function refreshPlayer() {
            playerAudio.load();
            
            if (!playerAudio.paused) {
                playerAudio.play()
                .catch(e => console.error('Error al refrescar:', e));
            }
            
            fetchNowPlaying();
        }
        
        // Formatear tiempo
        function formatTime(timestamp) {
            const date = new Date(timestamp * 1000);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // Actualizar historial de canciones
        function updateHistory(tracks) {
            historyContainer.innerHTML = '';
            
            if (!tracks || tracks.length === 0) {
                historyContainer.innerHTML = '<li class="collection-item" style="background-color: #1E1E1E; color: white;">No hay historial disponible</li>';
                return;
            }
            
            tracks.forEach((track, index) => {
                if (index === 0) return; // Saltar la canción actual
                
                const li = document.createElement('li');
                li.className = 'collection-item';
                li.style.backgroundColor = '#1E1E1E';
                li.style.color = 'white';
                li.style.borderBottom = '1px solid #333';
                
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${track.song.title}</strong>
                            <p style="margin: 0; color: #AAA;">${track.song.artist}</p>
                        </div>
                        <span style="color: #AAA;">${formatTime(track.played_at)}</span>
                    </div>
                `;
                
                historyContainer.appendChild(li);
            });
        }
        
        // Obtener datos actuales de la radio
        function fetchNowPlaying() {
            fetch(API_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Actualizar información de la canción
                    const nowPlaying = data.now_playing;
                    songTitle.textContent = nowPlaying.song.title || "Desconocido";
                    songArtist.textContent = nowPlaying.song.artist || "Desconocido";
                    
                    // Actualizar marquee
                    marqueeRadio.innerHTML = `<span>Estación KUSFM - ${nowPlaying.song.title} - ${nowPlaying.song.artist}</span>`;
                    
                    // Actualizar imagen del álbum
                    albumArt.src = nowPlaying.song.art || "https://i.imgur.com/ITZcSUM.png";
                    
                    // Actualizar información del DJ
                    const djName = data.live.is_live ? data.live.streamer_name : "AutoDJ";
                    const showName = data.live.is_live ? "Programa en vivo" : "Emisión Automática";
                    
                    locutor.textContent = djName;
                    locutorPrograma.textContent = showName;
                    
                    // Actualizar avatar de Habbo
                    setHabboAvatar(data.live.is_live ? data.live.streamer_name : "estacionkusfm");
                    
                    // Actualizar stats
                    numOuvintes.textContent = data.listeners.current;
                    statListeners.textContent = data.listeners.current;
                    statPeak.textContent = data.listeners.unique;
                    statSongs.textContent = data.song_history.length;
                    
                    // Actualizar historial
                    updateHistory(data.song_history);
                })
                .catch(error => {
                    console.error('Error al obtener datos:', error);
                    marqueeRadio.innerHTML = "<span>Estación KUSFM - Error al cargar información</span>";
                });
        }
        
        // Manejar errores de audio
        playerAudio.addEventListener('error', function() {
            console.error('Error de audio:', playerAudio.error);
            playIcon.classList.remove('fa-pause');
            playIcon.classList.add('fa-play');
            alert("Error en la transmisión. Intenta refrescar el reproductor.");
        });
        
        // Inicializar
        window.addEventListener('DOMContentLoaded', function() {
            setHabboAvatar("estacionkusfm");
            fetchNowPlaying();
            
            // Actualizar cada 15 segundos
            setInterval(fetchNowPlaying, 15000);
        });

        // ===================== NUEVO: PANEL DJ LOGIN/REGISTRO Y NOTICIAS/EVENTOS ======================
        // Panel DJ Login/Registro (LocalStorage DEMO)
        function showRegister() {
          document.getElementById('login-form').style.display = "none";
          document.getElementById('register-form').style.display = "block";
        }
        function showLogin() {
          document.getElementById('register-form').style.display = "none";
          document.getElementById('login-form').style.display = "block";
        }
        function registerDJ() {
          const user = document.getElementById('register-username').value.trim();
          const pass = document.getElementById('register-password').value;
          if(user && pass) {
            if(localStorage.getItem('dj_'+user)) {
              alert("Ese usuario ya está registrado.");
              return;
            }
            localStorage.setItem('dj_'+user, pass);
            alert("¡Registro exitoso!");
            showLogin();
          } else {
            alert("Completa todos los campos.");
          }
        }
        function loginDJ() {
          const user = document.getElementById('login-username').value.trim();
          const pass = document.getElementById('login-password').value;
          if(localStorage.getItem('dj_'+user) === pass && user && pass) {
            localStorage.setItem('dj_session', user);
            showDJPanel(user);
          } else {
            alert("Usuario o contraseña incorrectos.");
          }
        }
        function showDJPanel(user) {
          document.getElementById('login-form').style.display = "none";
          document.getElementById('register-form').style.display = "none";
          document.getElementById('dj-panel-info').style.display = "block";
          document.getElementById('dj-name').textContent = user;
          updateHoraMexico();
        }
        function logoutDJ() {
          localStorage.removeItem('dj_session');
          document.getElementById('dj-panel-info').style.display = "none";
          showLogin();
        }
        function updateHoraMexico() {
          const now = new Date();
          let utc = now.getTime() + (now.getTimezoneOffset() * 60000);
          let horaMX = new Date(utc + (3600000 * -6)); // UTC-6, ajusta si usas horario verano
          document.getElementById('hora-mx').textContent = horaMX.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(function() {
          if(document.getElementById('dj-panel-info').style.display === "block") updateHoraMexico();
        }, 60000);
        window.addEventListener('DOMContentLoaded', function() {
          const session = localStorage.getItem('dj_session');
          if(session) showDJPanel(session);
          else showLogin();
        });

        // Noticias/Eventos DEMO (puedes editar)
        const noticias = [
          { titulo: "¡Nuevo concurso de Habbo!", contenido: "Participa y gana premios exclusivos en nuestro fansite.", fecha: "2025-06-10" },
          { titulo: "Nueva interfaz EKUSFM 5.0", contenido: "¡Explora nuestro nuevo panel y funciones exclusivas para DJs!", fecha: "2025-06-10" }
        ];
        const eventos = [
          { titulo: "Evento especial DJ", contenido: "No te pierdas la sesión especial con premios y diversión.", fecha: "2025-06-15" },
          { titulo: "Maratón musical", contenido: "Este viernes, música sin parar desde las 6PM hora México.", fecha: "2025-06-13" }
        ];
        function renderNoticias() {
          const contenedor = document.querySelector('.noticias-lista');
          if(!contenedor) return;
          contenedor.innerHTML = '';
          noticias.forEach(n => {
            contenedor.innerHTML += `<article><h6>${n.titulo}</h6><p>${n.contenido}</p><span>${n.fecha}</span></article>`;
          });
        }
        function renderEventos() {
          const contenedor = document.querySelector('.eventos-lista');
          if(!contenedor) return;
          contenedor.innerHTML = '';
          eventos.forEach(e => {
            contenedor.innerHTML += `<article><h6>${e.titulo}</h6><p>${e.contenido}</p><span>${e.fecha}</span></article>`;
          });
        }
        window.addEventListener('DOMContentLoaded', function() {
          renderNoticias();
          renderEventos();
        });
        // ===================== FIN NUEVO ======================
    </script>
</body>
</html>
